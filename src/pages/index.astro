---
import reposData from '../data/repos.json';
import '../styles/global.css';

const categories = ["All", ...new Set(reposData.map(repo => repo.category))];

const repos = await Promise.all(reposData.map(async (repo) => {
  try {
    const res = await fetch(`https://api.github.com/repos/${repo.id}`, {
      headers: import.meta.env.GITHUB_TOKEN ? { Authorization: `token ${import.meta.env.GITHUB_TOKEN}` } : {}
    });
    const data = await res.json();
    return {
      name: data.name || repo.id.split('/')[1],
      desc: repo.customDesc || data.description || "Essential resource for AI engineering mastery.",
      stars: data.stargazers_count ? (data.stargazers_count / 1000).toFixed(1) + 'k' : '0.0k',
      url: data.html_url,
      category: repo.category,
      isStarter: repo.starter || false
    };
  } catch (e) {
    return { 
      name: repo.id, 
      desc: repo.customDesc || "Resource temporarily offline", 
      stars: "—", 
      url: repo.id.startsWith('http') ? repo.id : `https://github.com/${repo.id}`, 
      category: repo.category,
      isStarter: repo.starter || false 
    };
  }
}));
---

<html lang="en">
	<head>
		<meta charset="utf-8" />
		<link rel="icon" type="image/svg+xml" href="/favicon.svg" />
		<meta name="viewport" content="width=device-width" />
		<title>AetherIndex // The AI Beginner's Lifesaver</title>
		<meta property="og:image" content="https://aether-index.vercel.app/og_image.png" />
	</head>
	<body class="bg-[#02040a] text-white selection:bg-blue-500/30 font-sans">
		
		<nav class="border-b border-white/5 bg-black/60 backdrop-blur-xl sticky top-0 z-50">
			<div class="max-w-7xl mx-auto px-6 h-16 flex items-center justify-between">
				<div class="flex items-center gap-2">
					<div class="w-5 h-5 bg-blue-500 rounded-full animate-pulse"></div>
					<span class="font-bold tracking-tighter uppercase italic text-lg">Aether<span class="text-blue-500">Index</span></span>
				</div>
				<a href="#foundry" class="text-[10px] font-mono uppercase tracking-widest text-blue-400 border border-blue-400/20 px-4 py-2 rounded-full hover:bg-blue-400 hover:text-white transition-all">
					Launch Foundry →
				</a>
			</div>
		</nav>

		<header class="relative py-32 overflow-hidden border-b border-white/5">
			<div class="absolute inset-0 bg-[radial-gradient(circle_at_50%_50%,#1e1b4b,transparent)] opacity-50"></div>
			<div class="relative max-w-5xl mx-auto px-6 text-center">
				<div class="inline-block px-4 py-1.5 border border-blue-500/20 rounded-full bg-blue-500/10 text-[10px] font-mono text-blue-400 uppercase tracking-widest mb-8">
					The Open Source Entry Point
				</div>
				<h1 class="text-6xl md:text-8xl font-black tracking-tighter mb-8 leading-[0.9] uppercase italic">
					Zero to AI Master:<br/><span class="text-blue-500">The Foundry.</span>
				</h1>
				<p class="text-xl text-slate-400 font-light max-w-2xl mx-auto leading-relaxed mb-12">
					AetherIndex is your <span class="text-white font-medium italic">curated lifesaver</span>. Master AI through actual hands-on playing with the world's most vital open-source repositories.
				</p>
				<div class="mt-12 max-w-md mx-auto flex gap-2 p-1.5 bg-white/[0.03] border border-white/10 rounded-xl backdrop-blur-sm">
					<input type="email" placeholder="Get the weekly roadmap..." class="bg-transparent flex-1 px-4 py-2 text-sm outline-none font-mono" />
					<button class="bg-blue-600 hover:bg-blue-500 px-6 py-2 rounded-lg text-xs font-bold uppercase transition-all">Join</button>
				</div>
			</div>
		</header>

		<div class="max-w-7xl mx-auto px-6 flex flex-col md:flex-row gap-16 py-24" id="foundry">
			<aside class="w-full md:w-64 flex-shrink-0">
				<div class="sticky top-28">
					<div class="mb-10">
						<h3 class="text-[10px] font-mono uppercase tracking-[0.25em] text-slate-500 mb-6">Mastery_Sectors</h3>
						<nav class="flex flex-col gap-1">
							{categories.map(cat => (
								<button class="filter-btn text-left px-4 py-3 rounded-xl border border-transparent text-xs font-medium text-slate-400 hover:bg-white/5 hover:text-white transition-all flex items-center justify-between group" data-category={cat}>
									{cat}
									<span class="opacity-0 group-hover:opacity-100 transition-all text-blue-500 translate-x-[-10px] group-hover:translate-x-0">→</span>
								</button>
							))}
						</nav>
					</div>
					<div class="p-6 rounded-2xl border border-blue-500/10 bg-blue-500/5 backdrop-blur-sm">
						<h4 class="text-[10px] font-mono uppercase text-blue-400 mb-3">Lifesaver Tip</h4>
						<p class="text-[11px] text-slate-400 leading-relaxed italic">
							Follow the <span class="text-white">"Starter Kit"</span> badges to build your foundation before moving to "Agentic Architecture."
						</p>
					</div>
				</div>
			</aside>

			<main class="flex-1">
				<div class="mb-12">
					<input type="text" id="repo-search" placeholder="Search the Foundry (e.g., 'Agent', 'Math', 'Roadmap')..." class="w-full bg-white/[0.02] border border-white/10 rounded-2xl px-6 py-5 text-sm font-mono text-white focus:border-blue-500/50 focus:bg-white/[0.04] transition-all outline-none" />
				</div>
				<div class="grid grid-cols-1 lg:grid-cols-2 gap-8" id="repo-grid">
					{repos.map(repo => (
						<a href={repo.url} target="_blank" class="laser-card p-10 group block relative" data-category={repo.category} data-name={repo.name.toLowerCase()}>
							<div class="flex justify-between items-start mb-8">
								<span class="text-[9px] font-mono text-blue-400 bg-blue-400/10 px-3 py-1 rounded-full uppercase">
									{repo.category}
								</span>
								{repo.isStarter && (
									<span class="text-[9px] font-bold text-yellow-500 bg-yellow-500/10 border border-yellow-500/20 px-2 py-0.5 rounded animate-pulse">
										★ STARTER KIT
									</span>
								)}
							</div>
							<h3 class="text-2xl font-bold text-white group-hover:text-blue-400 transition-colors mb-4 tracking-tight uppercase italic">{repo.name}</h3>
							<p class="text-sm text-slate-500 leading-relaxed font-light italic line-clamp-2 mb-8">{repo.desc}</p>
							<div class="pt-6 border-t border-white/5 flex items-center justify-between">
								<span class="text-[9px] font-mono uppercase tracking-[0.2em] text-slate-600 group-hover:text-blue-500 transition-colors">Initialize_Module</span>
								<div class="text-[10px] text-slate-600 font-mono italic group-hover:text-white transition-colors">★ {repo.stars}</div>
							</div>
						</a>
					))}
				</div>
			</main>
		</div>

		<footer class="mt-40 border-t border-white/5 py-24 bg-[#010206]">
			<div class="max-w-7xl mx-auto px-6 text-center">
				<div class="font-bold tracking-tighter uppercase italic text-2xl mb-4">Aether<span class="text-blue-500">Index</span></div>
				<p class="text-xs text-slate-500 font-mono uppercase tracking-widest mb-10 italic">Your hands-on roadmap from scratch to AI Mastery.</p>
				<div class="flex justify-center gap-10 text-[10px] font-mono uppercase tracking-widest text-slate-700">
					<a href="#" class="hover:text-blue-400 transition-colors">Privacy_Protocol</a>
					<a href="#" class="hover:text-blue-400 transition-colors">Source_Archive</a>
				</div>
			</div>
		</footer>

		<script>
			const searchInput = document.getElementById('repo-search') as HTMLInputElement;
			const buttons = document.querySelectorAll('.filter-btn');
			const cards = document.querySelectorAll('#repo-grid > a') as NodeListOf<HTMLElement>;

			function filter() {
				const term = searchInput.value.toLowerCase();
				const activeBtn = document.querySelector('.filter-btn.bg-white\\/5') as HTMLElement;
				const activeCat = activeBtn?.getAttribute('data-category') || "All";

				cards.forEach(card => {
					const name = card.getAttribute('data-name') || "";
					const cat = card.getAttribute('data-category') || "";
					const matchesSearch = name.includes(term);
					const matchesCat = activeCat === "All" || cat === activeCat;
					card.style.display = matchesSearch && matchesCat ? 'block' : 'none';
				});
			}

			searchInput?.addEventListener('input', filter);
			buttons.forEach(btn => btn.addEventListener('click', () => {
				buttons.forEach(b => b.classList.remove('bg-white/5', 'text-white', 'border-white/10'));
				btn.classList.add('bg-white/5', 'text-white', 'border-white/10');
				filter();
			}));
		</script>
	</body>
</html>